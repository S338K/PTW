<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Validation Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'error-color': '#dc2626',
                        'success-color': '#16a34a'
                    }
                }
            }
        }
    </script>
    <style>
        input.invalid {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1) !important;
        }

        input.valid {
            border-color: #16a34a !important;
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.1) !important;
        }

        .error-message:not(:empty) {
            opacity: 1 !important;
            transform: translateY(0) !important;
        }
    </style>
</head>

<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-md p-6">
        <h1 class="text-2xl font-bold mb-6">Complete Form Validation Test</h1>

        <form id="testForm">
            <!-- Name Field -->
            <div class="floating-label relative mb-8">
                <input type="text" id="testName" placeholder=" "
                    class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none peer" />
                <label for="testName"
                    class="absolute top-1/2 left-4 transform -translate-y-1/2 text-gray-500 pointer-events-none transition-all duration-300 peer-focus:top-2 peer-focus:text-sm peer-focus:text-blue-500 peer-[:not(:placeholder-shown)]:top-2 peer-[:not(:placeholder-shown)]:text-sm peer-[:not(:placeholder-shown)]:text-blue-500">
                    Full Name
                </label>
                <span
                    class="error-message absolute left-3 bottom-[-20px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                    aria-live="polite"></span>
            </div>

            <!-- Email Field -->
            <div class="floating-label relative mb-8">
                <input type="email" id="testEmail" placeholder=" "
                    class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none peer" />
                <label for="testEmail"
                    class="absolute top-1/2 left-4 transform -translate-y-1/2 text-gray-500 pointer-events-none transition-all duration-300 peer-focus:top-2 peer-focus:text-sm peer-focus:text-blue-500 peer-[:not(:placeholder-shown)]:top-2 peer-[:not(:placeholder-shown)]:text-sm peer-[:not(:placeholder-shown)]:text-blue-500">
                    Email
                </label>
                <span
                    class="error-message absolute left-3 bottom-[-20px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                    aria-live="polite"></span>
            </div>

            <!-- Password Field -->
            <div class="floating-label relative mb-8">
                <input type="password" id="testPassword" placeholder=" "
                    class="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none peer" />
                <label for="testPassword"
                    class="absolute top-1/2 left-4 transform -translate-y-1/2 text-gray-500 pointer-events-none transition-all duration-300 peer-focus:top-2 peer-focus:text-sm peer-focus:text-blue-500 peer-[:not(:placeholder-shown)]:top-2 peer-[:not(:placeholder-shown)]:text-sm peer-[:not(:placeholder-shown)]:text-blue-500">
                    Password
                </label>
                <span
                    class="error-message absolute left-3 bottom-[-20px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                    aria-live="polite"></span>
            </div>

            <!-- Terms Checkbox -->
            <div class="relative mb-8">
                <label class="flex items-start space-x-3 text-base font-semibold text-gray-700 cursor-pointer">
                    <input type="checkbox" id="testTerms"
                        class="mt-1 w-4 h-4 text-blue-600 bg-white border-gray-300 rounded focus:ring-blue-500 focus:ring-2" />
                    <span>I agree to the Terms and Conditions</span>
                </label>
                <span
                    class="error-message absolute left-6 bottom-[-20px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                    aria-live="polite"></span>
            </div>

            <button type="submit" id="testSubmit"
                class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors">
                Test Form Validation
            </button>
        </form>

        <div id="results" class="mt-6 p-4 bg-gray-100 rounded-lg">
            <h3 class="font-bold mb-2">Validation Results:</h3>
            <div id="output" class="text-sm font-mono"></div>
        </div>
    </div>

    <script type="module">
        console.log('Validation test loaded');

        // Get elements
        const form = document.getElementById('testForm');
        const nameEl = document.getElementById('testName');
        const emailEl = document.getElementById('testEmail');
        const passwordEl = document.getElementById('testPassword');
        const termsEl = document.getElementById('testTerms');
        const output = document.getElementById('output');

        function log(message) {
            console.log(message);
            output.innerHTML += message + '<br>';
        }

        // Validation functions (from signup.js)
        function validateName(value) {
            return /^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]{2,50}$/.test(value.trim());
        }

        function validateEmail(value) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
        }

        function validatePassword(value, name, email) {
            const strongPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            if (!strongPattern.test(value)) return false;
            const lowerPass = value.toLowerCase();
            if (name && lowerPass.includes(name.toLowerCase())) return false;
            if (validateEmail(email) && lowerPass.includes(email.split('@')[0].toLowerCase())) return false;
            return true;
        }

        function validateTerms(checked) {
            return checked;
        }

        // Show error function (adapted for new structure)
        function showError(inputEl, message) {
            const group = inputEl.closest('.floating-label, .relative');
            if (!group) {
                log('Error: No container found for ' + inputEl.id);
                return;
            }
            const span = group.querySelector('.error-message');
            if (!span) {
                log('Error: No error-message span found for ' + inputEl.id);
                return;
            }
            span.textContent = message || '';
            if (message) {
                inputEl.classList.add('invalid');
                inputEl.classList.remove('valid');
                log(`${inputEl.id}: INVALID - "${message}"`);
            } else {
                inputEl.classList.remove('invalid');
                inputEl.classList.add('valid');
                log(`${inputEl.id}: VALID`);
            }
        }

        // Validate individual fields
        function validateField(inputEl) {
            let isValid = true;
            switch (inputEl.id) {
                case 'testName':
                    isValid = validateName(inputEl.value);
                    showError(inputEl, isValid ? '' : 'Letters only (2–50 chars).');
                    break;
                case 'testEmail':
                    isValid = validateEmail(inputEl.value);
                    showError(inputEl, isValid ? '' : 'Enter a valid email address 📧.');
                    break;
                case 'testPassword':
                    isValid = validatePassword(inputEl.value, nameEl.value, emailEl.value);
                    showError(inputEl, isValid ? '' : 'Min 8 chars, 1 letter, 1 number, 1 special char.');
                    break;
                case 'testTerms':
                    isValid = validateTerms(inputEl.checked);
                    showError(inputEl, isValid ? '' : 'Please accept the terms and conditions 📝.');
                    break;
            }
            return isValid;
        }

        // Validate entire form
        function validateForm() {
            log('--- FORM VALIDATION ---');
            let valid = true;
            [nameEl, emailEl, passwordEl, termsEl].forEach(input => {
                if (!validateField(input)) valid = false;
            });
            log(`Overall form valid: ${valid}`);
            return valid;
        }

        // Add real-time validation
        [nameEl, emailEl, passwordEl].forEach(input => {
            input.addEventListener('input', () => {
                log(`Input event on ${input.id}: "${input.value}"`);
                validateField(input);
            });
        });

        termsEl.addEventListener('change', () => {
            log(`Terms checkbox changed: ${termsEl.checked}`);
            validateField(termsEl);
        });

        // Form submit validation
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            log('--- FORM SUBMIT ---');
            const isValid = validateForm();
            if (isValid) {
                log('✅ Form is valid - would submit');
            } else {
                log('❌ Form has errors - submission blocked');
            }
        });

        log('Event listeners attached - try typing in the fields!');
    </script>
</body>

</html>