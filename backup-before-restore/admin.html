<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="../theme.css" />
    <link rel="stylesheet" href="./admin.css" />
    <meta name="api-base" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body>
    <header>
        <h1>Admin Dashboard</h1>
        <button id="addUserBtn">Add New User</button>
        <button id="logoutBtn">Logout</button>
    </header>

    <main>
        <!-- User Details & Role Management -->
        <section>
            <h2>User Details & Role Management</h2>
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Role</th>
                        <th>Status</th>
                        <th>Registered</th>
                        <th>Last Login</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="6">Loading…</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Permit Status Overview -->
        <section>
            <h2>Permit Status Overview</h2>
            <table id="permitsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Permit No.</th>
                        <th>Submitted</th>
                        <th>Requester Name</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="7">Loading…</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Summary Statistics -->
        <section>
            <h2>Summary Statistics</h2>
            <div class="stats-grid">
                <div class="card">
                    <h3>Total Users</h3>
                    <div class="value" id="statUsers">—</div>
                    <button class="expandBtn" onclick="toggleDetails('userBreakdown', this)">Expand</button>
                    <div class="breakdown" id="userBreakdown">
                        <p class="active">Active: <span id="statActiveUsers">—</span></p>
                        <p class="inactive">Inactive: <span id="statInactiveUsers">—</span></p>
                    </div>
                </div>
                <div class="card">
                    <h3>Total Permits</h3>
                    <div class="value" id="statPermits">—</div>
                    <button class="expandBtn" onclick="toggleDetails('permitBreakdown', this)">Expand</button>
                    <div class="breakdown" id="permitBreakdown">
                        <p class="pending">Pending: <span id="statPending">—</span></p>
                        <p class="inprogress">In Progress: <span id="statInProgress">—</span></p>
                        <p class="approved">Approved: <span id="statApproved">—</span></p>
                        <p class="rejected">Rejected: <span id="statRejected">—</span></p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Visual Analytics -->
        <section>
            <h2>Visual Analytics</h2>
            <div class="charts-row">
                <div class="chart-card">
                    <h3>User Status</h3>
                    <canvas id="userStatusChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>User Roles</h3>
                    <canvas id="userRoleChart"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Permit Status</h3>
                    <canvas id="permitStatusChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <!-- Add New User -->
    <div id="userModal" class="side-modal">
        <div class="side-modal-content">

            <!-- Header -->
            <div class="modal-header">
                <h2>Register New User</h2>
                <span class="close">&times;</span>
            </div>

            <!-- Body -->
            <div class="modal-body">
                <form id="userForm" method="POST" novalidate>
                    <label for="fullName">Full Name</label>
                    <input id="fullName" type="text" name="fullName" required>
                    <small class="error-msg"></small>

                    <label for="email">Email Address</label>
                    <input id="email" type="email" name="email" required>
                    <small class="error-msg"></small>

                    <label for="mobile">Mobile Number</label>
                    <input id="mobile" type="tel" name="mobile" required pattern="[0-9]{8,15}">
                    <small class="error-msg"></small>

                    <label for="company">Company</label>
                    <input id="company" type="text" name="company" required>
                    <small class="error-msg"></small>

                    <label for="department">Department</label>
                    <input id="department" type="text" name="department" required>
                    <small class="error-msg"></small>

                    <label for="designation">Designation</label>
                    <input id="designation" type="text" name="designation" required>
                    <small class="error-msg"></small>

                    <label for="password">Password</label>
                    <input id="password" type="password" name="password" required minlength="8">
                    <small class="error-msg"></small>

                    <label for="confirmPassword">Confirm Password</label>
                    <input id="confirmPassword" type="password" name="confirmPassword" required minlength="8">
                    <small class="error-msg"></small>

                    <label for="userType">User Type</label>
                    <select id="userType" name="role" required>
                        <option value="">-- Select --</option>
                        <option value="PreApprover">Pre-Approver</option>
                        <option value="Approver">Approver</option>
                        <option value="Admin">Admin</option>
                    </select>
                    <small class="error-msg"></small>
                </form>
            </div>

            <!-- Footer -->
            <div class="modal-footer">
                <button type="submit" form="userForm" class="btn view">Register</button>
            </div>
            <!-- Toast Notification -->
            <div id="toast"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="./admin.js"></script>
</body>

</html>