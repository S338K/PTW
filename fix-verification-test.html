<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix Verification Test</title>
    <!-- Chart.js for testing charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f0f0f0;
        }

        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            margin: -20px -20px 20px -20px;
            border-radius: 8px 8px 0 0;
        }

        .dropdown-container {
            position: relative;
            display: inline-block;
        }

        .dropdown-btn {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            min-width: 200px;
            padding: 10px;
        }

        .hidden {
            display: none !important;
        }

        .notification-count {
            background: red;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            margin-left: 10px;
        }

        .chart-container {
            width: 300px;
            height: 200px;
            margin: 20px 0;
        }

        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>

<body>
    <div class="test-section">
        <div class="header">
            <h1>PTW Profile Fixes Verification</h1>
            <p>Testing all implemented fixes</p>
        </div>

        <!-- Test 1: Date Utility Functions -->
        <h2>‚úÖ Test 1: Date Utility Functions</h2>
        <div id="dateTest" class="test-result"></div>
        <button onclick="testDateFunctions()">Test Date Functions</button>

        <!-- Test 2: Chart.js Integration -->
        <h2>üìä Test 2: Chart.js Integration</h2>
        <div class="chart-container">
            <canvas id="testChart" width="300" height="200"></canvas>
        </div>
        <div id="chartTest" class="test-result"></div>
        <button onclick="testChart()">Test Chart Creation</button>

        <!-- Test 3: Dropdown Functionality -->
        <h2>üîΩ Test 3: Dropdown Functionality</h2>
        <div class="dropdown-container">
            <button class="dropdown-btn" onclick="testToggleDropdown()">Profile Dropdown</button>
            <div id="testDropdown" class="dropdown hidden">
                <h3>Test Dropdown Content</h3>
                <p>This dropdown should show/hide properly</p>
            </div>
        </div>
        <div id="dropdownTest" class="test-result"></div>

        <!-- Test 4: Notification Count -->
        <h2>üîî Test 4: Notification Count</h2>
        <button onclick="testNotificationCount()">
            Notifications
            <span id="testNotificationCount" class="notification-count">3</span>
        </button>
        <div id="notificationTest" class="test-result"></div>

        <!-- Test Results Summary -->
        <h2>üìã Test Results Summary</h2>
        <div id="testSummary"></div>
    </div>

    <script>
        // Test Results Tracking
        let testResults = {
            dateUtility: false,
            chartjs: false,
            dropdown: false,
            notifications: false
        };

        // Test 1: Date Utility Functions
        function getTimeAgo(date) {
            // Ensure we have a valid Date object
            const dateObj = (date instanceof Date) ? date : new Date(date);

            // Check if date is valid
            if (isNaN(dateObj.getTime())) {
                console.warn('Invalid date passed to getTimeAgo:', date);
                return 'Unknown time';
            }

            const now = new Date();
            const diffMs = now - dateObj;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMins / 60);
            const diffDays = Math.floor(diffHours / 24);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            if (diffDays < 7) return `${diffDays}d ago`;
            return dateObj.toLocaleDateString();
        }

        function testDateFunctions() {
            const testEl = document.getElementById('dateTest');
            try {
                // Test different date formats
                const now = new Date();
                const fiveMinutesAgo = new Date(now.getTime() - 5 * 60000);
                const twoHoursAgo = new Date(now.getTime() - 2 * 60 * 60000);
                const threeDaysAgo = new Date(now.getTime() - 3 * 24 * 60 * 60000);

                const results = [
                    `Current time: ${getTimeAgo(now)}`,
                    `5 minutes ago: ${getTimeAgo(fiveMinutesAgo)}`,
                    `2 hours ago: ${getTimeAgo(twoHoursAgo)}`,
                    `3 days ago: ${getTimeAgo(threeDaysAgo)}`,
                    `String date: ${getTimeAgo('2025-10-09T10:00:00Z')}`,
                    `Invalid date: ${getTimeAgo('invalid-date')}`
                ];

                testEl.className = 'test-result success';
                testEl.innerHTML = '<strong>‚úÖ Date functions working!</strong><br>' + results.join('<br>');
                testResults.dateUtility = true;
            } catch (error) {
                testEl.className = 'test-result error';
                testEl.innerHTML = `<strong>‚ùå Date function error:</strong> ${error.message}`;
                testResults.dateUtility = false;
            }
            updateSummary();
        }

        // Test 2: Chart.js Integration
        function testChart() {
            const testEl = document.getElementById('chartTest');
            const ctx = document.getElementById('testChart');

            try {
                if (!window.Chart) {
                    throw new Error('Chart.js library not loaded');
                }

                if (ctx._chartInstance) {
                    ctx._chartInstance.destroy();
                }

                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Approved', 'Pending', 'Rejected'],
                        datasets: [{
                            data: [5, 3, 1],
                            backgroundColor: ['#28a745', '#ffc107', '#dc3545'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        plugins: {
                            legend: { position: 'bottom' }
                        },
                        cutout: '50%'
                    }
                });

                ctx._chartInstance = chart;
                testEl.className = 'test-result success';
                testEl.innerHTML = '‚úÖ Chart.js working! Chart created successfully.';
                testResults.chartjs = true;
            } catch (error) {
                testEl.className = 'test-result error';
                testEl.innerHTML = `‚ùå Chart.js error: ${error.message}`;
                testResults.chartjs = false;
            }
            updateSummary();
        }

        // Test 3: Dropdown Functionality
        function testToggleDropdown() {
            const dropdown = document.getElementById('testDropdown');
            const testEl = document.getElementById('dropdownTest');

            try {
                const isHidden = dropdown.classList.contains('hidden');

                if (isHidden) {
                    dropdown.classList.remove('hidden');
                    testEl.className = 'test-result success';
                    testEl.innerHTML = '‚úÖ Dropdown shown successfully!';
                } else {
                    dropdown.classList.add('hidden');
                    testEl.className = 'test-result success';
                    testEl.innerHTML = '‚úÖ Dropdown hidden successfully!';
                }

                testResults.dropdown = true;
            } catch (error) {
                testEl.className = 'test-result error';
                testEl.innerHTML = `‚ùå Dropdown error: ${error.message}`;
                testResults.dropdown = false;
            }
            updateSummary();
        }

        // Test 4: Notification Count
        function testNotificationCount() {
            const testEl = document.getElementById('notificationTest');
            const countEl = document.getElementById('testNotificationCount');

            try {
                const currentCount = parseInt(countEl.textContent) || 0;
                const newCount = currentCount > 0 ? 0 : 5;

                countEl.textContent = newCount;
                if (newCount > 0) {
                    countEl.style.display = 'inline';
                } else {
                    countEl.style.display = 'none';
                }

                testEl.className = 'test-result success';
                testEl.innerHTML = `‚úÖ Notification count updated to: ${newCount}`;
                testResults.notifications = true;
            } catch (error) {
                testEl.className = 'test-result error';
                testEl.innerHTML = `‚ùå Notification count error: ${error.message}`;
                testResults.notifications = false;
            }
            updateSummary();
        }

        // Update Test Summary
        function updateSummary() {
            const summaryEl = document.getElementById('testSummary');
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(result => result).length;

            let summaryHtml = `<div class="test-result ${passedTests === totalTests ? 'success' : 'error'}">`;
            summaryHtml += `<strong>Tests Passed: ${passedTests}/${totalTests}</strong><br>`;

            Object.entries(testResults).forEach(([test, passed]) => {
                summaryHtml += `${passed ? '‚úÖ' : '‚ùå'} ${test}<br>`;
            });

            if (passedTests === totalTests) {
                summaryHtml += '<br><strong>üéâ All fixes are working correctly!</strong>';
            } else {
                summaryHtml += '<br><strong>‚ö†Ô∏è Some issues remain to be fixed.</strong>';
            }

            summaryHtml += '</div>';
            summaryEl.innerHTML = summaryHtml;
        }

        // Initialize tests on page load
        window.onload = function () {
            console.log('Fix verification test page loaded');
            updateSummary();
        };
    </script>
</body>

</html>