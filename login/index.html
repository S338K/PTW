<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Page - Welcome to HIA Baggage Handling System</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS for theme integration and animations -->
    <link rel="stylesheet" href="../theme.css" />
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'hia-blue': '#273172',
                        'hia-light-blue': '#1a245a',
                        'hia-dark': '#1E245E',
                        'hia-surface': 'var(--bg-surface)',
                        'hia-text': 'var(--text-primary)'
                    },
                    fontFamily: {
                        'sans': ['system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif']
                    }
                }
            }
        };
    </script>
    <!-- marquee styles moved to ../theme.css -->
</head>

<body id="login-body"
    class="bg-[var(--bg-surface)] text-[var(--text-primary)] font-system transition-all duration-300 has-sticky-footer"
    data-no-idle>

    <!-- Header: logo left, theme toggle right (uses shared/theme-toggle.js) -->
    <nav id="page-header" class="w-full border-b border-[var(--input-border)] bg-[var(--bg-surface)]">
        <div class="px-4 py-3 flex items-center justify-between w-full">
            <div class="flex items-center">
                <div class="flex items-center gap-3">
                    <img src="../images/Logo.png" alt="HIA logo" class="h-10 w-auto" />
                    <span class="sr-only">HIA</span>
                </div>
            </div>

            <!-- Announcement area: expands between logo and theme toggle -->
            <div id="header-announcement" class="mx-4 flex-1">
                <div id="announcement-marquee" class="text-[var(--text-primary)] text-base"></div>
            </div>

            <div class="flex items-center">
                <button id="theme-toggle" type="button" data-theme-toggle
                    class="flex h-9 w-9 items-center justify-center rounded-full text-[var(--text-primary)] icon-btn hover-lite"
                    aria-label="Toggle theme">
                    <i class="fas fa-sun icon-sun text-xl"></i>
                    <i class="fas fa-moon icon-moon text-xl"></i>
                </button>
            </div>
        </div>
    </nav>

    <main class="min-h-screen gradient-bg py-8 px-4 relative overflow-hidden">

        <div id="backgroundLayer"
            class="fixed inset-0 -z-10 bg-cover bg-center bg-no-repeat transition-opacity duration-1000 opacity-0">
        </div>

        <div class="container mx-auto flex items-center justify-center min-h-[calc(100vh-200px)]">

            <div class="w-full max-w-md">
                <div class="login-card rounded-2xl border border-[var(--input-border)] bg-[var(--bg-surface)]
                  overflow-hidden transition-all duration-300 hover:scale-[1.02]">

                    <div class="bg-gradient-to-r from-hia-blue to-hia-light-blue p-6 text-center">
                        <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-user-shield text-2xl text-white"></i>
                        </div>
                        <h2 class="text-2xl font-bold text-white mb-2">Welcome</h2>
                        <p class="text-blue-100 text-sm">Sign in to access your account</p>
                    </div>

                    <div class="p-8">
                        <form id="loginForm" method="POST" novalidate class="space-y-6">

                            <div class="form-group relative">
                                <label for="email" class="block text-sm font-semibold text-[var(--text-primary)] mb-2">
                                    <i class="fas fa-envelope text-hia-blue mr-2"></i>
                                    Email Address
                                </label>
                                <div class="relative">
                                    <input type="email" id="email" name="email" placeholder="Enter your email address"
                                        required class="w-full px-4 py-3 pl-12 bg-[var(--bg-surface)] border-2 border-[var(--input-border)] 
                                                rounded-xl text-[var(--text-primary)] placeholder-gray-400 
                                                focus:border-hia-blue focus:outline-none focus:ring-2 focus:ring-hia-blue/20 
                                                transition-all duration-300 hover:border-hia-blue/60" />
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-at text-sm"></i>
                                    </div>
                                </div>

                            </div>


                            <div class="form-group relative">
                                <label for="password"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">
                                    <i class="fas fa-lock text-hia-blue mr-2"></i>
                                    Password
                                </label>
                                <div class="relative">
                                    <input type="password" id="password" name="password"
                                        placeholder="Enter your password" required class="w-full px-4 py-3 pl-12 bg-[var(--bg-surface)] border-2 border-[var(--input-border)] 
                                                rounded-xl text-[var(--text-primary)] placeholder-gray-400 
                                                focus:border-hia-blue focus:outline-none focus:ring-2 focus:ring-hia-blue/20 
                                                transition-all duration-300 hover:border-hia-blue/60" />
                                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <i class="fas fa-lock text-sm"></i>
                                    </div>
                                </div>
                            </div>


                            <div class="mt-6">
                                <button id="loginBtn" type="submit"
                                    class="w-full flex items-center justify-center px-4 py-3 bg-gradient-to-r from-hia-blue to-hia-light-blue rounded-xl font-semibold hover:shadow-lg transition-all duration-200 transform hover:scale-[1.02] text-white">
                                    <span class="relative z-10 flex items-center justify-center">
                                        <i class="fas fa-sign-in-alt mr-2"></i>
                                        Sign in to your account
                                    </span>
                                </button>
                            </div>
                        </form>


                        <div class="mt-8 space-y-4 text-center">
                            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 
                                      text-sm text-[var(--text-primary)]">
                                <div class="forgot-password-link">
                                    <span class="text-[var(--text-secondary)]">Forgot Password?</span>
                                    <a href="../forgot-password/forgot-password.html" id="forgotPasswordLink" class="ml-1 text-[var(--link-color)] font-semibold hover:text-[var(--link-hover)] 
                                            transition-colors duration-200 hover:underline">
                                        Reset here
                                    </a>
                                </div>
                                <div class="sign-up-link">
                                    <span class="text-[var(--text-secondary)]">Need an account?</span>
                                    <a href="#" id="openSignupModal" class="ml-1 text-[var(--link-color)] font-semibold hover:text-[var(--link-hover)] 
                                            transition-colors duration-200 hover:underline">
                                        Sign up
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="sessionConflictModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true"
        aria-labelledby="session-conflict-title">
        <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm"></div>
        <div
            class="relative mx-auto mt-32 w-[min(92vw,420px)] rounded-2xl bg-white dark:bg-gray-800 shadow-2xl border border-gray-200 dark:border-gray-700 p-6 flex flex-col gap-4">
            <div class="flex items-start gap-3">
                <div
                    class="flex h-12 w-12 items-center justify-center rounded-full bg-amber-100 text-amber-600 dark:bg-amber-500/10">
                    <i class="fas fa-triangle-exclamation text-xl"></i>
                </div>
                <div class="flex-1 space-y-2">
                    <h2 id="session-conflict-title" class="text-lg font-semibold text-gray-800 dark:text-white">Active
                        session detected</h2>
                    <p id="sessionConflictMessage" class="text-sm text-gray-700 dark:text-gray-300">
                        You're already signed in on another device or browser. Continue here to sign out there and use
                        this device instead?
                    </p>
                </div>
            </div>
            <div class="flex items-center justify-end gap-3">
                <button type="button" id="sessionConflictCancel"
                    class="px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-100 transition-colors">Stay
                    signed in there</button>
                <button type="button" id="sessionConflictConfirm"
                    class="px-4 py-2 rounded-lg bg-amber-500 hover:bg-amber-600 text-white font-semibold transition-colors">Use
                    this device</button>
            </div>
        </div>
    </div>

    <!-- Sign Up Modal (reused signup form fields) -->
    <div id="signupModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true"
        aria-labelledby="signup-modal-title">
        <div id="signupModalOverlay" class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm"></div>
        <div
            class="relative mx-auto mt-16 w-[min(96vw,720px)] rounded-2xl bg-[var(--bg-surface)] shadow-2xl border border-[var(--input-border)] p-6 max-h-[80vh] overflow-auto">
            <div class="flex items-center justify-between mb-4">
                <h2 id="signup-modal-title" class="text-lg font-semibold text-[var(--text-primary)]">Create an account
                </h2>
                <button id="closeSignupModal" aria-label="Close sign up"
                    class="text-[var(--text-primary)] hover:text-[var(--link-hover)]">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Modal content: copied from signup/signup.html (trimmed layout) -->
            <form id="signupForm" method="POST" action="" novalidate>
                <div class="space-y-6">
                    <div class="w-full mb-4 relative">
                        <label for="signupName" class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Full
                            Name</label>
                        <input type="text" id="signupName" name="username" autocomplete="name" required
                            placeholder="Enter full name"
                            class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base transition-all duration-200 bg-[var(--bg-surface)] text-[var(--text-primary)] focus:border-hia-blue focus:shadow-lg focus:outline-none" />
                        <span
                            class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                            aria-live="polite"></span>
                    </div>

                    <div class="w-full mb-4 relative">
                        <label for="companyName"
                            class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Company Name</label>
                        <input type="text" id="companyName" name="company" autocomplete="organization" required
                            placeholder="Enter company name"
                            class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base transition-all duration-200 bg-[var(--bg-surface)] text-[var(--text-primary)] focus:border-hia-blue focus:shadow-lg focus:outline-none" />
                        <span
                            class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                            aria-live="polite"></span>
                    </div>

                    <div class="w-full mb-4 relative">
                        <label for="signupEmail"
                            class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Email Address</label>
                        <input type="email" id="signupEmail" name="email" autocomplete="email" required
                            placeholder="Enter email address"
                            class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base transition-all duration-200 bg-[var(--bg-surface)] text-[var(--text-primary)] focus:border-hia-blue focus:shadow-lg focus:outline-none" />
                        <span
                            class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                            aria-live="polite"></span>
                    </div>

                    <div class="w-full mb-4 relative">
                        <label for="signupPhone"
                            class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Phone Number</label>
                        <input type="tel" id="signupPhone" name="phone" autocomplete="tel" required
                            placeholder="Enter phone number" pattern="^\+974\d{8,}$" aria-describedby="signupPhoneHelp"
                            class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base transition-all duration-200 bg-[var(--bg-surface)] text-[var(--text-primary)] focus:border-hia-blue focus:shadow-lg focus:outline-none" />
                        <p id="signupPhoneHelp" class="mt-2 text-xs text-[var(--text-secondary)]">Include country code
                            +974. Example: <span class="font-mono">+97412345678</span></p>
                        <span
                            class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                            aria-live="polite"></span>
                    </div>

                    <div class="w-full mb-4 relative">
                        <label for="signupPassword"
                            class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Password</label>
                        <input type="password" id="signupPassword" name="password" autocomplete="new-password" required
                            placeholder="Create a password"
                            class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base transition-all duration-200 bg-[var(--bg-surface)] text-[var(--text-primary)] focus:border-hia-blue focus:shadow-lg focus:outline-none" />
                        <span
                            class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                            aria-live="polite"></span>
                    </div>

                    <div class="w-full mb-4 relative">
                        <label for="signupConfirmPassword"
                            class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Confirm Password</label>
                        <input type="password" id="signupConfirmPassword" name="confirmPassword"
                            autocomplete="new-password" required placeholder="Confirm your password"
                            class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base transition-all duration-200 bg-[var(--bg-surface)] text-[var(--text-primary)] focus:border-hia-blue focus:shadow-lg focus:outline-none" />
                        <span
                            class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium"
                            aria-live="polite"></span>
                    </div>

                    <!-- Office Address (copied from signup page) -->
                    <fieldset
                        class="w-full border-2 border-[var(--input-border)] rounded-2xl p-4 text-[var(--text-primary)] mb-4">
                        <legend class="text-left text-sm font-normal px-2 text-[var(--text-primary)]">Office Address
                        </legend>
                        <div id="officeAddressSection"
                            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 lg:gap-5 w-full">
                            <div class="mb-4 relative">
                                <label for="buildingNo"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Building
                                    No.</label>
                                <input type="text" id="buildingNo" name="buildingNo" required maxlength="2"
                                    pattern="^\d{1,2}$"
                                    class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base bg-[var(--bg-surface)] text-[var(--text-primary)]"
                                    placeholder="Enter building number" />
                                <span
                                    class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0"
                                    aria-live="polite"></span>
                            </div>
                            <div class="mb-4 relative">
                                <label for="floorNo"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Floor
                                    No.</label>
                                <input type="text" id="floorNo" name="floorNo" required maxlength="2"
                                    pattern="^\d{1,2}$"
                                    class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base bg-[var(--bg-surface)] text-[var(--text-primary)]"
                                    placeholder="Enter floor number" />
                                <span
                                    class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0"
                                    aria-live="polite"></span>
                            </div>
                            <div class="mb-4 relative">
                                <label for="streetNo"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Street
                                    No.</label>
                                <input type="text" id="streetNo" name="streetNo" required maxlength="3"
                                    pattern="^\d{1,3}$"
                                    class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base bg-[var(--bg-surface)] text-[var(--text-primary)]"
                                    placeholder="Enter street number" />
                                <span
                                    class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0"
                                    aria-live="polite"></span>
                            </div>
                            <div class="mb-4 relative">
                                <label for="zone"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Zone</label>
                                <input type="text" id="zone" name="zone" required maxlength="2" pattern="^\d{1,2}$"
                                    class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base bg-[var(--bg-surface)] text-[var(--text-primary)]"
                                    placeholder="Enter zone" />
                                <span
                                    class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0"
                                    aria-live="polite"></span>
                            </div>
                            <div class="mb-4 relative">
                                <label for="city"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">City</label>
                                <input type="text" id="city" name="city" required pattern="^[A-Za-z\s]+$"
                                    class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base bg-[var(--bg-surface)] text-[var(--text-primary)]"
                                    placeholder="Enter city" />
                                <span
                                    class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0"
                                    aria-live="polite"></span>
                            </div>
                            <div class="mb-4 relative">
                                <label for="country"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">Country</label>
                                <input type="text" id="country" name="country" required pattern="^[A-Za-z\s]+$"
                                    class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base bg-[var(--bg-surface)] text-[var(--text-primary)]"
                                    placeholder="Enter country" />
                                <span
                                    class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0"
                                    aria-live="polite"></span>
                            </div>
                            <div class="mb-4 relative">
                                <label for="poBox"
                                    class="block text-sm font-semibold text-[var(--text-primary)] mb-2">P.O. Box</label>
                                <input type="text" id="poBox" name="poBox" required maxlength="6" pattern="^\d{1,6}$"
                                    class="w-full p-4 border-2 border-[var(--input-border)] rounded-3xl text-base bg-[var(--bg-surface)] text-[var(--text-primary)]"
                                    placeholder="Enter P.O. Box" />
                                <span
                                    class="error-message absolute left-3 bottom-[-18px] text-error-color text-xs opacity-0"
                                    aria-live="polite"></span>
                            </div>
                        </div>
                    </fieldset>

                    <div class="relative mt-2 mb-4">
                        <label
                            class="flex items-start space-x-3 text-base font-semibold text-[var(--text-secondary)] cursor-pointer">
                            <input type="checkbox" id="termsCheckbox" name="terms"
                                class="mt-1 w-4 h-4 text-button-bg bg-[var(--bg-surface)] border-[var(--input-border)] rounded focus:ring-button-bg focus:ring-2" />
                            <span class="text-[var(--text-primary)]">I agree to the <a href="../signup/terms.html"
                                    target="_blank" class="text-[var(--link-color)] underline">Terms and
                                    Conditions</a></span>
                        </label>
                        <span
                            class="error-message absolute left-6 bottom-[-18px] text-error-color text-xs opacity-0 transform translate-y-1 transition-all duration-300 pointer-events-none font-medium max-w-[calc(100%-1.5rem)]"
                            aria-live="polite"></span>
                    </div>

                    <button id="signupBtn" type="submit"
                        class="w-full bg-button-bg text-white border-2 border-button-bg px-6 py-3 text-base font-semibold rounded-lg cursor-pointer transition-all duration-300 hover:bg-button-hover hover:border-button-hover">Create
                        Account</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../shared/toast.js"></script>
    <script>
        // Realtime validation for signup and registration forms
        (function () {
            function safeShowToast(type, msg) {
                if (typeof window.showToast === 'function') return window.showToast(type, msg);
                try { alert(msg); } catch (e) { /* ignore */ }
            }

            const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
            const alphaRe = /^[A-Za-z\s]+$/;
            const numericRe = /^\d+$/;
            // Require Qatar country code +974 followed by at least 8 digits (e.g. +97412345678)
            const phoneRe = /^\+974\d{8,}$/;
            const passwordRe = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/;

            function getFieldLabel(input) {
                if (!input) return 'This field';
                const id = input.id;
                let lbl = null;
                if (id) lbl = document.querySelector(`label[for="${id}"]`);
                if (!lbl) {
                    // try to find a label in the same container
                    const group = input.closest('.relative') || input.parentElement;
                    if (group) lbl = group.querySelector('label');
                }
                if (lbl) return (lbl.textContent || lbl.innerText || 'This field').trim();
                // fallback to name attribute prettified
                if (input.name) return String(input.name).replace(/([A-Z])/g, ' $1').replace(/[_-]/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                return 'This field';
            }

            function showFieldError(input, msg) {
                // Intentionally do not show inline field errors.
                // Keep error-message spans empty/hidden to avoid duplicate UI; we surface errors via toast.
                const group = input.closest('.relative') || input.parentElement;
                const span = group ? group.querySelector('.error-message') : null;
                if (span) {
                    span.textContent = '';
                    span.style.opacity = '0';
                }
                // Do not change input styles here.
            }

            function validateInput(input) {
                const id = input.id || input.name || '';
                // Handle checkbox specially
                if (input.type === 'checkbox') {
                    return input.checked ? { ok: true } : { ok: false, msg: 'Please accept the terms and conditions.' };
                }
                const val = (input.value || '').trim();
                if (!val) {
                    // leave required check to submit; show a gentle hint on blur
                    return { ok: true };
                }
                switch (id) {
                    case 'signupName':
                    case 'r-fullName':
                        return alphaRe.test(val) ? { ok: true } : { ok: false, msg: 'Use letters only.' };
                    case 'companyName':
                    case 'r-companyName':
                        return alphaRe.test(val) ? { ok: true } : { ok: false, msg: 'Use letters only.' };
                    case 'signupPhone':
                    case 'r-mobile':
                        // normalize common separators so users can type +974 1234-5678 or (+974)12345678
                        const cleanedVal = val.replace(/[\s\-()]/g, '');
                        return phoneRe.test(cleanedVal) ? { ok: true } : { ok: false, msg: 'Phone must start with +974 and contain at least 8 digits.' };
                    case 'signupEmail':
                    case 'r-email':
                        return emailRe.test(val) ? { ok: true } : { ok: false, msg: 'Enter a valid email.' };
                    case 'signupPassword':
                    case 'r-password':
                        return passwordRe.test(val) ? { ok: true } : { ok: false, msg: 'Min 8 chars, upper, lower, number, special.' };
                    case 'signupConfirmPassword':
                    case 'r-confirmPassword':
                        const pw = document.getElementById(id.replace('confirmPassword', 'password')) || document.getElementById('signupPassword') || document.getElementById('r-password');
                        return (pw && pw.value === val) ? { ok: true } : { ok: false, msg: 'Passwords must match.' };
                    case 'buildingNo':
                    case 'floorNo':
                    case 'streetNo':
                    case 'zone':
                    case 'poBox':
                    case 'r-buildingNumber':
                    case 'r-floorNumber':
                    case 'r-streetNumber':
                    case 'r-zone':
                    case 'r-poBox':
                        // These fields must be numeric only
                        return numericRe.test(val) ? { ok: true } : { ok: false, msg: 'Numbers only.' };
                    case 'r-country':
                    case 'country':
                    case 'r-city':
                    case 'city':
                        // City and Country should be alphabetic only
                        return alphaRe.test(val) ? { ok: true } : { ok: false, msg: 'Letters only.' };
                    default:
                        return { ok: true };
                }
            }

            function wireForm(form) {
                if (!form) return;
                const inputs = Array.from(form.querySelectorAll('input'));
                inputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        // For checkboxes validate on change
                        input.addEventListener('change', () => {
                            const res = validateInput(input);
                            if (!res.ok) {
                                input.classList.add('invalid');
                                input.setAttribute('aria-invalid', 'true');
                                safeShowToast('info', res.msg);
                            } else {
                                input.classList.remove('invalid');
                                input.removeAttribute('aria-invalid');
                            }
                        });
                    } else {
                        // On blur show a gentle toast and toggle visual invalid state
                        input.addEventListener('blur', () => {
                            const res = validateInput(input);
                            const isEmptyRequired = input.required && !input.value.trim();
                            if (!res.ok) {
                                // mark visually invalid and show toast
                                input.classList.add('invalid');
                                input.setAttribute('aria-invalid', 'true');
                                safeShowToast('info', res.msg);
                            } else if (isEmptyRequired) {
                                input.classList.add('invalid');
                                input.setAttribute('aria-invalid', 'true');
                                const label = getFieldLabel(input);
                                safeShowToast('info', `${label} is required.`);
                            } else {
                                // valid — clear visual error
                                input.classList.remove('invalid');
                                input.removeAttribute('aria-invalid');
                            }
                        });
                    }
                    // Also clear visual invalid state when user types
                    input.addEventListener('input', () => {
                        input.classList.remove('invalid');
                        input.removeAttribute('aria-invalid');
                    });
                });

                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    let firstInvalid = null;
                    let valid = true;
                    for (const input of inputs) {
                        // check required presence (handle checkboxes specially)
                        if (input.required) {
                            if (input.type === 'checkbox') {
                                if (!input.checked) {
                                    valid = false;
                                    firstInvalid = firstInvalid || input;
                                    const label = getFieldLabel(input);
                                    input.classList.add('invalid');
                                    input.setAttribute('aria-invalid', 'true');
                                    safeShowToast('error', `${label} is required.`);
                                    break;
                                }
                            } else if (!input.value.trim()) {
                                valid = false;
                                firstInvalid = firstInvalid || input;
                                const label = getFieldLabel(input);
                                // show toast and mark input visually
                                input.classList.add('invalid');
                                input.setAttribute('aria-invalid', 'true');
                                safeShowToast('error', `${label} is required.`);
                                break;
                            }
                        }
                        const res = validateInput(input);
                        if (!res.ok) {
                            valid = false;
                            firstInvalid = firstInvalid || input;
                            input.classList.add('invalid');
                            input.setAttribute('aria-invalid', 'true');
                            safeShowToast('error', res.msg);
                            break;
                        }
                    }
                    if (!valid) {
                        if (firstInvalid) firstInvalid.focus();
                        return;
                    }
                    // success — clear any visual invalid markers
                    inputs.forEach(i => i.classList.remove('invalid'));
                });
            }

            document.addEventListener('DOMContentLoaded', () => {
                wireForm(document.getElementById('signupForm'));
                wireForm(document.getElementById('registrationForm'));
            });
        })();
    </script>
    <script src="../shared/theme-toggle.js"></script>
    <script type="module" src="../signup/signup.js"></script>
    <script type="module" src="index.js"></script>
    <!-- Footer -->
    <footer id="page-footer"
        class="bg-[var(--bg-surface)] border-t border-[var(--input-border)]/20 mt-8 py-4 text-center text-sm text-[var(--text-primary)]">
        <div class="container mx-auto px-4">
            <p>Copyright 2025 Hamad International Airport. All rights reserved.</p>
            <p class="mt-1">Session cookies are used to keep you logged in securely. By continuing you agree to our
                cookie policy.</p>
        </div>
    </footer>
</body>

</html>